<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Flasher HomeSend</title>
<style>
  body {
    font-family: sans-serif;
    background: #121212;
    color: #fff;
    min-height: 100vh;
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 20px;
  }
  h2 { margin-bottom: 20px; text-align: center; }
  .container { width: 100%; max-width: 400px; display: flex; flex-direction: column; gap: 20px; }
  label { display: block; margin-top: 10px; font-weight: bold; }
  select, input[type="text"], input[type="number"], input[type="password"] {
    padding: 10px; font-size: 1em; margin-top: 5px; width: 100%;
    border-radius: 5px; border: 1px solid #444; background: #1e1e1e; color: #fff;
  }
  button {
    margin-top: 10px; padding: 12px; font-size: 1em; cursor: pointer;
    background: #1f6feb; border: none; color: white; border-radius: 5px; transition: 0.2s;
  }
  button:hover { background: #1557c1; }
  hr { border-color: #333; margin: 20px 0; }
</style>
</head>
<body>

<h2>Flasher HomeSend</h2>

<div id="page-content" class="container" style="display:none;">

  <!-- Server URL Selection -->
  <h3>Choisir Serveur</h3>
  <label><input type="radio" name="server" value="http://192.168.4.1" checked> Serveur Local</label>
  <label><input type="radio" name="server" value="http://192.168.0.4"> Serveur Réseau (AVEC ROUTEUR)</label>
  <hr>

  <!-- IR Code Section -->
  <label for="btn">Choisir Button:</label>
  <select id="btn">
    <option value="tv_pwr">TV Power</option>
    <option value="tv_chup">TV Channel Up</option>
    <option value="tv_chdn">TV Channel Down</option>
    <option value="tv_volup">TV Volume Up</option>
    <option value="tv_voldn">TV Volume Down</option>
    <option value="tv_mute">TV Mute</option>
    <option value="tv_up">TV Up</option>
    <option value="tv_down">TV Down</option>
    <option value="tv_left">TV Left</option>
    <option value="tv_right">TV Right</option>
    <option value="tv_enter">TV Ok</option>
    <option value="tv_list">TV List</option>
    <option value="tv_exit">TV Exit</option>
  </select>

  <label for="code">Entrer Code IR:</label>
  <input type="text" id="code" placeholder="Code IR ici">
  <button onclick="uploadCode()">Send IR</button>

  <hr>

  <!-- Activation Section -->
  <label for="activationCode">Entrer code Activation:</label>
  <input type="number" id="activationCode" min="0" max="2000" placeholder="Code Activation ici">
  <button onclick="sendActivation()">Confirmer</button>

  <hr>
  
  <!-- Light Number Selection -->
  <h3>Sélectionnez nombre Lampes</h3>
  <select id="sendLightNumber">
    <option value="">-- Choisir --</option>
  </select>
  <button onclick="sendLightNumber()">Confirmer</button>

  <hr>

  <!-- Set Password Section -->
  <label for="newPass">Changer mot de passe:</label>
  <input type="password" id="newPass" placeholder="Nouveau mot de passe">
  <button onclick="setPassword()">Envoyer</button>

</div>

<script>
let currentKey = "1111"; // Security code

// Prompt security on load
window.onload = function() {
  let userKey = prompt("Entrer code securite pour acceder:");
  if (userKey === null || userKey !== currentKey) {
    alert("Code incorrect! Access refuse.");
    document.body.innerHTML = "<h2 style='color:red;'>Access denied.</h2>";
    return;
  }
  document.getElementById('page-content').style.display = 'flex';
  fillLightOptions();
};

// Get selected server URL
function getServerUrl() {
  const selected = document.querySelector('input[name="server"]:checked');
  return selected ? selected.value : "http://192.168.4.1";
}

// Upload IR Code
function uploadCode() {
  const SERVER_URL = getServerUrl();
  const btn = document.getElementById('btn').value;
  let code = document.getElementById('code').value.trim().toUpperCase();
  if (code.startsWith("0X")) code = code.substring(2);

  const hexRegex = /^[0-9A-F]{8}$/;
  if (!hexRegex.test(code)) { alert("Code doit être 8 chiffres hexadécimaux!"); return; }

  const link = `${SERVER_URL}/storecode?btn=${encodeURIComponent(btn)}&code=${encodeURIComponent(code)}&key=${currentKey}`;
  fetch(link)
    .then(r => r.text())
    .then(msg => alert("Réponse: " + msg))
    .catch(err => alert("Erreur: " + err));
}

// Send Activation
function sendActivation() {
  const SERVER_URL = getServerUrl();
  let code = parseInt(document.getElementById('activationCode').value, 10);
  if (isNaN(code) || code < 0 || code > 2000) {
    alert("Code doit être entre 0 et 2000!");
    return;
  }

  const link = `${SERVER_URL}/activation?code=${code}`;
  fetch(link)
    .then(r => r.text())
    .then(msg => alert("Réponse: " + msg))
    .catch(err => alert("Erreur: " + err));
}

// Fill light number options
function fillLightOptions() {
  const select = document.getElementById('sendLightNumber');
  for (let i = 1; i <= 10; i++) {
    const option = document.createElement('option');
    option.value = i;
    option.textContent = i;
    select.appendChild(option);
  }
}

// Send Light Number
function sendLightNumber() {
  const SERVER_URL = getServerUrl();
  let code = parseInt(document.getElementById('sendLightNumber').value, 10);

  if (isNaN(code) || code < 1 || code > 10) {
    alert("Code doit être entre 1 et 10!");
    return;
  }

  const link = `${SERVER_URL}/setlights?n=${code}`;
  fetch(link)
    .then(r => r.text())
    .then(msg => alert("Réponse: " + msg))
    .catch(err => alert("Erreur: " + err));
}

// Set new password
function setPassword() {
  const SERVER_URL = getServerUrl();
  let newPass = document.getElementById('newPass').value.trim();
  if (newPass.length === 0) { alert("Entrez un mot de passe valide!"); return; }

  const link = `${SERVER_URL}/setpwd?p=${encodeURIComponent(newPass)}&key=${currentKey}`;
  fetch(link)
    .then(r => r.text())
    .then(msg => alert("Réponse: " + msg))
    .catch(err => alert("Erreur: " + err));
}
</script>

</body>
</html>
